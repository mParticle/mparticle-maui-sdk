name: Pull request

on:
  pull_request:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: read
  checks: write
  id-token: write

jobs:
  pr-branch-check-name:
    name: "Check PR for semantic branch name"
    uses: mParticle/mparticle-workflows/.github/workflows/pr-branch-check-name.yml@stable
  pr-title-check:
    name: "Check PR for semantic title"
    uses: mParticle/mparticle-workflows/.github/workflows/pr-title-check.yml@stable
  pr-branch-target-gitflow:
    name: "Check PR for semantic target branch"
    uses: mParticle/mparticle-workflows/.github/workflows/pr-branch-target-gitflow.yml@stable
  Build: 
    runs-on: macOS-15
    steps:
    - uses: actions/checkout@v4
    - name: Install Android SDK 34
      run: |
        yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --install "platforms;android-34"
    - name: Install Mono Framework for nuget command
      run: |
        curl https://download.mono-project.com/archive/6.12.0/macos-10-universal/MonoFramework-MDK-6.12.0.206.macos10.xamarin.universal.pkg -o /tmp/MonoFramework-MDK-6.12.0.206.macos10.xamarin.universal.pkg
        sudo installer -pkg /tmp/MonoFramework-MDK-6.12.0.206.macos10.xamarin.universal.pkg -target /
    - name: Install MAUI workload
      run: dotnet workload install maui
    - name: Make build script executable
      run: chmod +x build.sh
    - name: Build artifacts
      run: ./build.sh

  pr-notify:
    if: >
      github.event_name == 'pull_request' &&
      github.event.pull_request.draft == false
    needs:
      - Build
      - pr-branch-check-name
      - pr-title-check
      - pr-branch-target-gitflow
    name: Notify GChat
    uses: ROKT/rokt-workflows/.github/workflows/oss_pr_opened_notification.yml@main
    secrets:
      gchat_webhook: ${{ secrets.GCHAT_PRS_WEBHOOK }}
